<%if (@activity.errors.empty?) %>

    var createMarkerWithInfoWindow = function () {

        // Remove previous marker
        clearMarker(activityNewMarker);

        // Create marker info
        var markerInfo = {
            position: new google.maps.LatLng(<%= @activity.location %>),
            map: Gmaps.map.serviceObject,
            id: <%= @activity.id %>
        }

        // Create new marker
        var marker = new google.maps.Marker(markerInfo);

        // Add marker serviceObject
        markerInfo.serviceObject = marker;

        // Add to the markers array
        Gmaps.map.markers.push(markerInfo);

        // On click open infowindow
        google.maps.event.addListener(marker, "click", function (e) {
            openInfowindow(
                "<%= j(render :template => 'activities/show.html.erb',
                              :locals  => { :activity => @activity}) %>",
                marker
            )
        });

        // New pane content
        $("#contextual-panel").html("<%=j(render :partial => 'create_side') %>");


        // Notify user
        alert_user("Got it. A new activity has been added!","alert-info");

    }

    // Invoke it
    createMarkerWithInfoWindow();


<%else%>

    // Notify user
    alert_user("Aj Got :(... I can't insert that. <%= j(raw(@activity.errors.full_messages.join(','))) %>", "alert-error");

<%end%>

replaceTemporaryWithPermanentMarker();
